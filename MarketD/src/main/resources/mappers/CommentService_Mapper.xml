<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.team.marketd.persistence.CommentService_Mapper">

	<select id="selectCommentList" parameterType="HashMap" resultType="cv"><!--댓글 리스트 SQL 실행 3은 보여줄 코멘트 수-->
	
		select ROWNUM,cidx,midx,pidx,cwriter,ccontent,cwridate,corigincidx,cleftright,cupdown,cip,cdelip,cdelyn from
        (select* from comment32 where cdelyn='N' and pidx= #{pidx} order by corigincidx desc ) 
			<if test="page!=0">
			<![CDATA[ where ROWNUM<=(#{page}*10) ]]>
			</if>
	</select>

	<update id="deleteCommentAction" parameterType="cv" ><!--댓글 삭제 SQL 실행-->
		
		update comment32 
		set cdelyn='Y', cdelip=#{cdelip} 
		where cidx =#{cidx}
	
	</update>

	<insert id="insertComment" parameterType="HashMap" > <!--댓글 작성 SQL 실행(댓글 입략, 계층처리)-->
	
		insert into comment32(cidx,midx,pidx,cwriter,ccontent,corigincidx,cip)
		values(comment_seq.nextval,#{midx},#{pidx},#{cwriter},#{ccontent},comment_seq.nextval,#{cip})
	
	</insert>

	<update id="replycomment" parameterType="Integer" ><!--댓글 업뎃 준비 SQL 실행-->
	
		update comment32 set cupdown = cupdown+1 where corigincidx = #{0} and cupdown>#{1}
	
	</update>

	<insert id="insertCommentReply" parameterType="HashMap" > <!--댓글에 답글 작성 SQL 실행-->
	
		insert into comment32(cidx,midx,pidx,cwriter,ccontent,corigincidx, cleftright , cupdown, cip) 
		values(comment_seq.nextval,#{midx},#{pidx},#{cwriter},#{ccontent},#{corigincidx},#{cleftright}+1,#{cupdown}+1, #{cip})
	
	</insert>
	
	<select id="selectCommentOne" parameterType="Integer" resultType="cv"><!--댓글 리스트 SQL -->
	
		select cidx,midx,pidx,cwridate,corigincidx,cleftright,cupdown,cip,cdelip,cdelyn from comment32 
		where cdelyn='N' and cidx=#{cidx}  
			
	</select>
	
	<select id="selectCommentTotal" parameterType="HashMap" resultType="Integer"><!--코멘트 : 검색 및 페이징 처리-->
	
		 select count(*) as cnt from member32 A inner join comment32 B on A.midx = B.midx 
				  where cdelyn='N' order by corigincidx, cupdown
				  
	</select>
	
</mapper>